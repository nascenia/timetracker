.row{ 'data-controller' => 'attendances' }
  %table.table.table-hover.table-bordered#monthly-attendance-table
    %thead
      %tr
        %th{:rowspan => "2"} Name
        %th{:colspan => "3"}= Time.now.strftime('%B, %Y')
        %th{:colspan => "3"}= 1.month.ago.strftime('%B, %Y')
      %tr
        %th Average in time
        %th Total hours
        %th Average hours
        %th Average in time
        %th Total hours
        %th Average hours
    %tbody
      - @users.each do |user|
      - current_month =  user.attendances.monthly_attendance_summary(Date.today.at_beginning_of_month, Date.today).includes(:children)
      - previous_month =  user.attendances.monthly_attendance_summary(1.month.ago.at_beginning_of_month, 1.month.ago.end_of_month).includes(:children)
        %tr
          %td
            %a.monthly-summary{:href => 'javascript:void(0)', 
              'data-action' => 'click->summary-modal#openModal',
              'data-controller' => "summary-modal",
              'data-summary-modal-url-param' => "/attendances/monthly_summary?user_id=#{user.id}&month=#{Time.now.month}&year=#{Time.now.year}"}
              = user.name
          %td= Attendance.monthly_average_check_in_time(current_month)
          %td{"data-order" => "#{Attendance.monthly_total_hours(current_month)}"}
            = Attendance.get_humanize_total_hour(current_month)
          %td{"data-order" => "#{Attendance.monthly_average_hours(current_month)}"}
            = Attendance.humanized_average_hours(Attendance.monthly_average_hours(current_month))
          %td= Attendance.monthly_average_check_in_time(previous_month)
          %td{"data-order" => "#{Attendance.monthly_total_hours(previous_month)}"}
            = Attendance.get_humanize_total_hour(previous_month)
          %td{"data-order" => "#{Attendance.monthly_average_hours(previous_month)}"}
            = Attendance.humanized_average_hours(Attendance.monthly_average_hours(previous_month))
.row
  #attendance-summary &nbsp;

= render 'modal'
