%h2 Projects summary report
%hr

= render 'search_form'

.col-md-12
  = link_to 'Download weekly report', weekly_report_projects_path(start_date: params[:project][:start_date], end_date: params[:project][:end_date], format: 'xls'),  class: 'btn btn-default'
  = link_to 'Download monthly report', monthly_report_projects_path(start_date: params[:project][:start_date], end_date: params[:project][:end_date], format: 'xls'),  class: 'btn btn-default'
  = link_to 'Old view', show_all_projects_path(selected_index: 2, start_date: 7.days.ago.strftime('%Y/%m/%d'), end_date: Time.now.strftime('%Y/%m/%d'))

%table.table.table-bordered#projects-summary
  %thead>
    %tr
      %th Name
      %th Total hours
      %th Projects

  %tbody
  - @users.each do |user|
    %tr
      %td= user.name
      %td= total_working_hours(@timesheets[user.id])
      %td= user_timesheet_summary(@timesheets[user.id])

:javascript

  $(document).ready(function() {

    var dataTable = $('#projects-summary').DataTable({
      lengthChange: false,
      pageLength: 100,
      dom: '<"dt-top-left"Tf>lrtip',
      buttons: ['print']
    });

    $(document).on("turbolinks:before-cache", function() {
      if (dataTable !== null) {
        dataTable.destroy();
        dataTable = null;
      }
    });
  });
  